<project name="web-client" default="build">

   <path id="common.path" path="${basedir}/../.." />
   <property name="common.dir" refid="common.path" />
   <import file="${common.dir}/common.xml" />

   <!-- we want to build a WAR file in this project -->
   <target name="package" depends="package-war" />

   <target name="package-war" depends="package-jar" description="Packages the WAR file for the current server">
      <package-specific-war for="${server}" />
   </target>
   
   <!-- define macro to build the war and use different exclude lists for -->
   <!-- different appservers -->
   <macrodef name="package-specific-war">
      <attribute name="for" />
      <sequential>
         <echo>Building WAR file for @{for}</echo>
         <mkdir dir="${dist.dir}" />
         <war warfile="${dist.dir}\${war.name}" webxml="${src.web.dir}\WEB-INF\web.xml">
            <fileset dir="${src.web.dir}" excludes="WEB-INF\web.xml,WEB-INF\classes\*" />
            <zipfileset dir="${src.webinf.dir}\classes" prefix="web-inf/classes" />
            <zipfileset dir="${common.lib.dir}" prefix="web-inf/lib"
                        includes="${webinf.lib.includes}" 
                        excludes="${@{for}.webinf.lib.excludes}" />
            <zipfileset dir="${common.lib.dir}/jibx" includes="*.jar" prefix="web-inf/lib" />
            <zipfileset dir="${common.lib.dir}/openoffice" includes="*.jar" prefix="web-inf/lib" />
            <zipfileset dir="${dist.dir}" includes="${jar.name}" prefix="web-inf/lib" />
            <zipfileset dir="${common.dir}/projects/core/build/dist" prefix="web-inf/lib"
                        includes="core.jar" />
            <zipfileset dir="${common.dir}/projects/repository/build/dist" prefix="web-inf/lib"
                        includes="repository.jar" />
         </war>
      </sequential>
   </macrodef>

</project>
