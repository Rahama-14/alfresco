<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE beans PUBLIC '-//SPRING//DTD BEAN//EN' 'http://www.springframework.org/dtd/spring-beans.dtd'>
 
<beans>
   <!-- File Server Configuration -->
   <bean id="fileServerConfiguration" class="org.alfresco.filesys.server.config.ServerConfiguration" init-method="init">
      <constructor-arg>
         <ref bean="serviceRegistry" />
      </constructor-arg>
      <constructor-arg>
         <ref bean="authenticationManager"/>
      </constructor-arg>
      <constructor-arg>
         <value>alfresco/file-servers.xml</value>
      </constructor-arg>
      <constructor-arg>
         <ref bean="contentDiskDriver" />
      </constructor-arg>
   </bean>
   
   <!-- CIFS Server -->
   <bean id="cifsServer" class="org.alfresco.filesys.CIFSServer" init-method="startServer" depends-on="importerBootstrap">
      <constructor-arg>
         <ref bean="fileServerConfiguration"/>
      </constructor-arg>
   </bean>
   
   <!-- FTP Server -->
   <bean id="ftpServer" class="org.alfresco.filesys.FTPServer" init-method="startServer" depends-on="importerBootstrap">
      <constructor-arg>
         <ref bean="fileServerConfiguration"/>
      </constructor-arg>
   </bean>

   <!-- Filesystem Interface -->   
   <bean id="contentDiskDriver" class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
      <property name="proxyInterfaces">
         <value>org.alfresco.filesys.smb.server.repo.ContentDiskInterface</value>
      </property>
      <property name="transactionManager"><ref bean="transactionManager"/></property>
      <property name="target">
         <bean class="org.alfresco.filesys.smb.server.repo.ContentDiskDriver" >
            <constructor-arg>
               <ref bean="serviceRegistry" />
            </constructor-arg>
            <constructor-arg>
               <ref bean="cifsHelper" />
            </constructor-arg>
         </bean>
      </property>
      <property name="transactionAttributes">
         <props>
            <prop key="*">PROPAGATION_REQUIRED</prop>
         </props>
      </property>
      <!-- only enable for debugging
      <property name="postInterceptors">
         <list>
            <ref bean="methodCallLogAdvice" />
            <bean class="org.alfresco.util.perf.PerformanceMonitorAdvice" >
               <constructor-arg>
                  <value>contentDiskDriver</value>
               </constructor-arg>
            </bean>
         </list>
      </property>
      -->
   </bean>

   <bean id="cifsHelper" class="org.alfresco.filesys.smb.server.repo.CifsHelper">
      <property name="nodeService"><ref bean="nodeService" /></property>
      <property name="dictionaryService"><ref bean="dictionaryService" /></property>
      <property name="namespaceService"><ref bean="namespaceService" /></property>
      <property name="mimetypeService"><ref bean="mimetypeMap" /></property>
      <property name="filePathCache">
         <bean class="org.alfresco.filesys.server.filesys.cache.FilePathCache" >
            <constructor-arg>
               <ref bean="policyComponent" />
            </constructor-arg>
         </bean>
      </property>
   </bean>
</beans>