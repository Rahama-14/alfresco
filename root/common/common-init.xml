<project name="common-init">

    <!-- ***************************** -->
    <!-- ** Common Task definitions ** -->
    <!-- ***************************** -->

    <!-- ant-contrib:  <if>,<then>,<else>,<for>,<throw>, etc.                    -->
    <!-- See also:     http://ant-contrib.sourceforge.net/tasks/tasks/index.html -->

    <taskdef resource="net/sf/antcontrib/antlib.xml"
             classpath="${dir.common}/../projects/3rd-party/lib/ant-contrib.jar"/>




    <!-- *************************** -->
    <!-- ** Common initialisation ** -->
    <!-- *************************** -->

    <target name="init">
        <tstamp>
            <format property="time" pattern="HH:mm" />
            <format property="date" pattern="ddMMyyyy" />
        </tstamp>

        <property environment="env" />
        <path id="path.root" path="${dir.common}/.."/>
        <property name="dir.product.root" refid="path.root"/>
        <property file="${user.home}/user-override.properties" />
        <property file="project-override.properties" />
        <property file="${dir.product.root}/projects/repository/config/alfresco/version.properties" />
        <property file="${dir.common}/common.properties" />
        <property file="project.properties" />

        <path id="classpath.compile">
            <fileset dir="${dir.common.lib}">
                <include name="**/*.jar" />
            </fileset>
            <fileset dir="${dir.projects}">
                <include name="**/build/dist/*.jar" />
            </fileset>
        </path>


        <path id="classpath.javadoc">
            <path refid="classpath.compile"/>

            <!-- TODO:                                                      -->
            <!--                                                            -->
            <!-- Unless the following jars are added here, javadoc fails    -->
            <!-- This would not be the case if they were moved to 3rd-party -->
            <!-- Is there any reason why this should not be done?           -->

            <pathelement location="${dir.project.benchmark-framework}/lib/japex/japex.jar"/>  
            <pathelement location="${dir.project.benchmark-framework}/lib/ostermillerutils_1_06_00.jar"/>  
        </path>


        <path id="classpath.unit.test">
            <dirset dir="${dir.projects}">
                <include name="**/build/classes" />
            </dirset>
            <pathelement location="${user.home}"/>
            <pathelement location="${dir.project.repository}/${dir.name.config}"/>
            <pathelement location="${dir.project.webclient}/${dir.name.config}"/>
            <pathelement location="${dir.project.jcr}/${dir.name.config}"/>
            <pathelement location="${dir.src.test.resources}" />
            <fileset dir="${dir.common.lib}">
                <include name="**/*.jar" />
            </fileset>
        </path>

        <!-- load the JIBX task definition -->
        <taskdef name="bind" classname="org.jibx.binding.ant.CompileTask"
                 classpath="${dir.common.lib}/jibx/jibx-bind.jar;${dir.common.lib}/jibx/jibx-run.jar;${dir.common.lib}/bcel.jar;${dir.common.lib}/xpp3-1.1.3_8.jar" />

        <echo level="info">${startup.message}</echo>
    </target>

    <!-- **************************** -->
    <!-- ** Common utility targets ** -->
    <!-- **************************** -->

    <target name="dump-properties" depends="init">
        <antcall target="dump-env-properties" />
        <antcall target="dump-dir-properties" />
        <antcall target="dump-file-properties" />
    </target>
   
    <target name="dump-env-properties" depends="init">
        <echo level="info">ant.project.name = ${ant.project.name}</echo>
        <echo level="info">basedir = ${basedir}</echo>
        <echo level="info">dir.product.root = ${dir.product.root}</echo>
        <echo level="info">user.home = ${user.home}</echo>
        <echo level="info">version.number = ${version.number}</echo>
        <echo level="info">home.jboss = ${home.jboss}</echo>
        <echo level="info">home.tomcat = ${home.tomcat}</echo>
        <echo level="info">home.findbugs = ${home.findbugs}</echo>
        <echo level="info">ant.home = ${ant.home}</echo>
    </target>

    <target name="dump-dir-properties" depends="init">
        <echoproperties prefix="dir" />
    </target>

    <target name="dump-file-properties" depends="init">
        <echoproperties prefix="file" />
    </target>

    <target name="dump-arbitary-properties" depends="init">
        <fail unless="prefix" message="You must supply a prefix i.e. -Dprefix=file.name" />
        <echoproperties prefix="${prefix}" />
    </target>

    <target name="dump-all-properties" depends="init">
        <echoproperties />
    </target>

    <target name="setup" depends="init">
        <mkdir dir="${dir.src.java}" />
        <mkdir dir="${dir.src.webinf}" />
        <mkdir dir="${dir.local.lib}" />
        <mkdir dir="${dir.classes}" />
    </target>

</project>
