<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE beans PUBLIC '-//SPRING//DTD BEAN//EN' 'http://www.springframework.org/dtd/spring-beans.dtd'>

<beans>

    <!-- Bootstrap Records Management Models -->
    
    <bean id="org_alfresco_module_dod5015_dictionaryBootstrap" parent="dictionaryModelBootstrap" depends-on="dictionaryBootstrap">
        <property name="models">
            <list>
                <value>alfresco/module/org_alfresco_module_dod5015/model/recordsModel.xml</value>
                <value>alfresco/module/org_alfresco_module_dod5015/model/dod5015Model.xml</value>
                <value>alfresco/module/org_alfresco_module_dod5015/bootstrap/content/recordsCustomModel.xml</value>
            </list>
        </property>
    </bean>
    
    <!-- Bootstrap the permission model -->
    
    <bean id="org_alfresco_module_dod5015_permissionBootstrap" parent="permissionModelBootstrap">
    	<property name="model" value="alfresco/module/org_alfresco_module_dod5015/model/recordsPermissionModel.xml"/>
    </bean>
    
    <!-- Bootstrap records management data -->
    
    <bean id="org_alfresco_module_dod5015_bootstrapData" class="org.alfresco.repo.module.ImporterModuleComponent" parent="module.baseComponent">
        <property name="moduleId" value="org_alfresco_module_dod5015" />
        <property name="name" value="org_alfresco_module_dod5015_bootstrapData" />
        <property name="description" value="Bootstrap records management data" />
        <property name="sinceVersion" value="1.0" />
        <property name="appliesFromVersion" value="1.0" />
        <!-- Data properties -->
        <property name="importer" ref="spacesBootstrap"/>
        <property name="bootstrapViews">
            <list>
                <props>
                    <prop key="path">/${spaces.company_home.childname}/${spaces.dictionary.childname}</prop>
                    <prop key="location">alfresco/module/org_alfresco_module_dod5015/bootstrap/RMDataDictionaryBootstrap.xml</prop>
                </props>
            </list>
        </property>
    </bean>
    
    <!-- Import fixed permission definitions for RM -->
    <import resource="classpath:alfresco/module/org_alfresco_module_dod5015/rm-public-services-security-context.xml"/>
    
    <!-- Import the RM service's -->
    <import resource="classpath:alfresco/module/org_alfresco_module_dod5015/rm-service-context.xml"/>
      
    <!-- Actions -->
    
    <bean id="rmAction" parent="action-executer" abstract="true">
        <property name="nodeService" ref="NodeService"/>
        <property name="contentService" ref="ContentService"/>
        <property name="dictionaryService" ref="DictionaryService"/>
        <property name="actionService" ref="ActionService"/>
        <property name="namespaceService" ref="NamespaceService"/>
        <property name="recordsManagementActionService" ref="RecordsManagementActionService"/>
        <property name="recordsManagementService" ref="RecordsManagementService"/>
        <property name="recordsManagementEventService" ref="RecordsManagementEventService"/>
        <property name="publicAction" value="false"/>
    </bean>
    
    <bean id="file" class="org.alfresco.module.org_alfresco_module_dod5015.action.impl.FileAction" parent="rmAction"/>    
    <bean id="cutoff" class="org.alfresco.module.org_alfresco_module_dod5015.action.impl.CutOffAction" parent="rmAction"/>
    <bean id="destroy" class="org.alfresco.module.org_alfresco_module_dod5015.action.impl.DestroyAction" parent="rmAction"/>
    <bean id="retain" class="org.alfresco.module.org_alfresco_module_dod5015.action.impl.RetainAction" parent="rmAction"/>
    
    <bean id="openRecordFolder" class="org.alfresco.module.org_alfresco_module_dod5015.action.impl.OpenRecordFolderAction" parent="rmAction"/>
    <bean id="closeRecordFolder" class="org.alfresco.module.org_alfresco_module_dod5015.action.impl.CloseRecordFolderAction" parent="rmAction"/>
    <bean id="reviewed" class="org.alfresco.module.org_alfresco_module_dod5015.action.impl.ReviewedAction" parent="rmAction"/>
    <bean id="setupRecordFolder" class="org.alfresco.module.org_alfresco_module_dod5015.action.impl.SetupRecordFolderAction" parent="rmAction"/>
    <bean id="declareRecord" class="org.alfresco.module.org_alfresco_module_dod5015.action.impl.DeclareRecordAction" parent="rmAction"/>
    <bean id="undeclareRecord" class="org.alfresco.module.org_alfresco_module_dod5015.action.impl.UndeclareRecordAction" parent="rmAction"/>
    <bean id="broadcastVitalRecordDefinition" class="org.alfresco.module.org_alfresco_module_dod5015.action.impl.BroadcastVitalRecordDefinitionAction"
                                            parent="rmAction"/>
    <bean id="defineCustomProperty" class="org.alfresco.module.org_alfresco_module_dod5015.action.impl.DefineCustomPropertyAction"
          parent="rmAction"/>
    <bean id="defineCustomAssociation" class="org.alfresco.module.org_alfresco_module_dod5015.action.impl.DefineCustomAssociationAction"
          parent="rmAction"/>

    <!-- Event types -->
    
    <bean id="rmEventType" init-method="init" abstract="true">
      <property name="recordsManagementEventService" ref="RecordsManagementEventService"/>
    </bean>
    
    <bean id="rmEventType.simple" class="org.alfresco.module.org_alfresco_module_dod5015.event.SimpleRecordsManagementEventTypeImpl" parent="rmEventType"/>

    <!-- Scheduled actions -->
    
    <!--
    <bean id="scheduledDispositionJobDetail" class="org.springframework.scheduling.quartz.JobDetailBean">
        <property name="jobClass">
            <value>org.alfresco.module.org_alfresco_module_dod5015.action.ScheduledDispositionJob</value>
        </property>
        <property name="jobDataAsMap">
            <map>
                <entry key="nodeService">
                    <ref bean="nodeService" />
                </entry>
                <entry key="searchService">
                    <ref bean="searchService"/>
                </entry>
                <entry key="recordsManagementActionService">
                    <ref bean="recordsManagementActionService" />
                </entry>
            </map>
        </property>
    </bean>
    
    <bean id="scheduledDispositionTrigger" class="org.alfresco.util.CronTriggerBean">
        <property name="jobDetail">
            <ref bean="scheduledDispositionJobDetail" />
        </property>
        <property name="scheduler">
            <ref bean="schedulerFactory" />
        </property>
        <property name="cronExpression">
            <value>0,30 * * ? * *</value>
        </property>
    </bean>
    -->
    
    <bean id="RMModuleComponent" class="org.alfresco.module.org_alfresco_module_dod5015.RecordsManagementModuleComponent" parent="module.baseComponent">
        <!-- init caveatConfig behaviours  -->
        <property name="executeOnceOnly" value="false"/>
        
        <property name="moduleId" value="org_alfresco_module_dod5015"/>
        <property name="caveatConfigImpl" ref="caveatConfigImpl"/>
        
    </bean>
    
    <!-- RM caveats -->
    <!-- Caveat read veto is now enforced via the security wrappers for RM -->

    <bean id="caveatConfigImpl" class="org.alfresco.module.org_alfresco_module_dod5015.caveat.RMCaveatConfigImpl">
        <property name="policyComponent" ref="policyComponent"/>
        <property name="contentService" ref="contentService"/>
        <property name="dictionaryService" ref="dictionaryService"/>
        <property name="namespaceService" ref="namespaceService"/>
        <property name="authorityService" ref="authorityService"/>
        <property name="personService" ref="personService"/>
        <property name="nodeService" ref="nodeService"/>
    </bean>
    
    <bean id="rmListOfValuesContraintInit" class="org.alfresco.module.org_alfresco_module_dod5015.caveat.RMListOfValuesConstraint">
        <property name="caveatConfigImpl" ref="caveatConfigImpl"/>
    </bean>
    
    <!-- ReST impl for RM Action Service -->
    <bean id="webscript.org.alfresco.rma.rmaction.post"
          class="org.alfresco.module.org_alfresco_module_dod5015.script.RmActionPost" parent="webscript">
          <property name="recordsManagementActionService" ref="RecordsManagementActionService" />
          <property name="nodeService" ref="NodeService" />
    </bean>
	
</beans>
