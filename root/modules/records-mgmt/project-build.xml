<project name="rm" default="package-war">
	
	<property name="file.extension.amp" value=".amp"/>
	
	<path id="path.common" path="${basedir}/../../common"/>
   	<property name="dir.common" refid="path.common"/>
   	<import file="${dir.common}/common.xml"/>
	
	<target name="package" depends="package-war"/>
	
	<path id="class.path">
	  	<pathelement path="../../projects/core/build/classes" />
	  	<fileset dir="../../projects/3rd-party/lib" includes="*.jar"/>
	  	<pathelement path="../../projects/repository/build/classes" />	  
   	</path>
	
   	<target name="package-war" depends="package-extension" if="${module.id}.enabled">
		<echo>Installing records management into WAR</echo>
   		<java dir="." fork="true" classname="org.alfresco.repo.module.tool.ModuleManagementTool">
            <classpath refid="class.path"/>
            <arg line="install ${dist.dir}/${module.id}${file.extension.amp} ${dir.project.webclient}/build/dist/${file.name.war.alfresco} -force -verbose -nobackup"/>
        </java>
   	</target>
	
	<target name="package-extension" depends="package-jar" description="Packages the extension">
		<echo>Packaging records management AMP file</echo>
		<zip destfile="${dist.dir}/${module.id}${file.extension.amp}" update="true">
			<zipfileset file="${property.dir}/module.properties"/>
			<zipfileset file="${package.file.jar}" prefix="lib"/>
   	     	<zipfileset dir="${config.dir}" prefix="config">
   	     		<exclude name="**/module.properties"/>
			</zipfileset>
   		</zip>
	</target>
   
</project>