<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE beans PUBLIC '-//SPRING//DTD BEAN//EN' 'http://www.springframework.org/dtd/spring-beans.dtd'>

<beans>

	<!--                       -->
	<!-- Configuration Service -->
	<!--                       -->

	<bean id="site.configsource"
		   class="org.alfresco.config.source.UrlConfigSource">
		<constructor-arg>
			<list>
				<value>classpath:alfresco/web-site-config.xml</value>
				<value>classpath:alfresco/web-site-config-model.xml</value>
				<value>classpath:alfresco/web-site-config-remote.xml</value>								

				<value>classpath:alfresco/extension/web-site-config-custom.xml</value>
				<value>jar:*!/META-INF/web-site-config-custom.xml</value>
			</list>
		</constructor-arg>
	</bean>

	<bean id="site.config"
		   class="org.alfresco.config.xml.XMLConfigService" init-method="init">
		<constructor-arg>
			<ref bean="site.configsource" />
		</constructor-arg>
	</bean>


	<!--                                                     -->
	<!-- Configuration of the Web Script Runtime / Container -->
	<!--                                                     -->
	<bean id="site.store.webscripts" class="org.alfresco.web.scripts.ClassPathStore">
		<property name="mustExist">
			<value>true</value>
		</property>
		<property name="classPath">
			<value>alfresco/site-webscripts</value>
		</property>
	</bean>
	<bean id="site.searchpath" class="org.alfresco.web.scripts.SearchPath">
		<property name="searchPath">
			<list>
				<ref bean="site.store.webscripts" />
				<ref bean="webscripts.store" />
			</list>
		</property>
	</bean>
	<bean id="site.webscripts.templateprocessor" class="org.alfresco.web.scripts.PresentationTemplateProcessor">
		<property name="searchPath" ref="site.searchpath" />
		<property name="defaultEncoding"><value>UTF-8</value></property>
	</bean>
	<bean id="site.webscripts.scriptprocessor" class="org.alfresco.web.scripts.PresentationScriptProcessor">
		<property name="searchPath" ref="site.searchpath" />
	</bean>	
	<bean id="site.webscripts.index" class="org.alfresco.web.scripts.JaxRSUriIndex" />   
	<bean id="site.webscripts.container" parent="webscripts.abstractcontainer" class="org.alfresco.web.scripts.LocalWebScriptRuntimeContainer">
		<property name="name"><value>WebFramework</value></property>
		<property name="registry" ref="site.webscripts.registry" />
		<property name="templateProcessor" ref="site.webscripts.templateprocessor" />
		<property name="scriptProcessor" ref="site.webscripts.scriptprocessor" />
		<property name="configService" ref="site.config" />
	</bean>
	
	<bean id="site.webscripts.registry" class="org.alfresco.web.scripts.DeclarativeRegistry">
		<property name="container" ref="site.webscripts.container" />
		<property name="uriIndex" ref="site.webscripts.index" />
		<property name="searchPath" ref="site.searchpath" />
		<property name="defaultWebScript"><value>webscript.default</value></property>
	</bean>
	


	<!--                                                    -->
	<!-- Configuration of the FreeMarker Template Processor -->
	<!--                                                    -->
	<bean id="site.store.templates"
		class="org.alfresco.web.scripts.ClassPathStore">
		<property name="mustExist">
			<value>true</value>
		</property>
		<property name="classPath">
			<value>alfresco/templates</value>
		</property>
	</bean>
   <bean id="site.templates.searchpath" class="org.alfresco.web.scripts.SearchPath">
      <property name="searchPath">
         <list>
            <ref bean="site.store.templates" />
            <ref bean="site.store.webscripts" />
         </list>
      </property>
   </bean>	
	<bean id="site.templateprocessor"
		class="org.alfresco.web.scripts.PresentationTemplateProcessor">
		<property name="searchPath"
			ref="site.templates.searchpath" />
		<property name="defaultEncoding">
			<value>UTF-8</value>
		</property>
	</bean>



	<!--                                -->
	<!-- Resource Storage Configuration -->
	<!--                                -->
	<!-- 
		TODO:  This isn't yet utilized but will be once storage can be
		remoted from the Repo/AVM
	 -->
	<bean id="site.store.modelobjects"
		class="org.alfresco.web.scripts.ClassPathStore">
		<property name="mustExist">
			<value>true</value>
		</property>
		<property name="classPath">
			<value>alfresco/site-data</value>
		</property>
	</bean>
	<bean id="site.model.searchpath"
		class="org.alfresco.web.scripts.SearchPath">
		<property name="searchPath">
			<list>
				<ref bean="site.store.modelobjects" />
			</list>
		</property>
	</bean>

	<!--  Declarative Site Web Script -->
	<bean id="webscript.site" parent="webscript"
		class="org.alfresco.web.scripts.DeclarativeSiteWebScript"
		singleton="false">
		<constructor-arg>
			<ref bean="site.store.modelobjects" />
		</constructor-arg>
	</bean>

	<!--  Dynamic Wizard Web Script -->
	<bean id="webscript.wizard" parent="webscript"
		class="org.alfresco.web.scripts.DeclarativeSiteWizardWebScript"
		singleton="false">
		<constructor-arg>
			<ref bean="site.store.modelobjects" />
		</constructor-arg>
	</bean>

</beans>