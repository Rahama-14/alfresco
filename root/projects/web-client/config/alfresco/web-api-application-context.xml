<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE beans PUBLIC '-//SPRING//DTD BEAN//EN' 'http://www.springframework.org/dtd/spring-beans.dtd'>

<beans>

   <!--  -->   
   <!--  Web API Configuration -->
   <!--  -->   

   <bean id="web.api.ConfigSource" class="org.alfresco.config.source.UrlConfigSource">
      <constructor-arg>
         <list>
            <value>classpath:alfresco/web-api-config.xml</value>
            <value>classpath:alfresco/extension/web-api-config-custom.xml</value>
         </list>
      </constructor-arg>
   </bean>

   <bean id="web.api.Config" class="org.alfresco.config.xml.XMLConfigService" init-method="init">
      <constructor-arg>
         <ref bean="web.api.ConfigSource" />
      </constructor-arg>
   </bean>


   <!--  -->
   <!--  Web API Formats -->
   <!--  -->

   <!--  Format Registry -->
   <bean id="web.api.FormatRegistry" class="org.alfresco.web.api.FormatRegistry" />

   <!--  Format Map -->
   <bean id="web.api.FormatMap" class="org.alfresco.web.api.FormatMap" abstract="true">
      <property name="registry" ref="web.api.FormatRegistry" />
   </bean>

   <!--  Default set of API Formats -->
   <bean id="web.api.Formats" parent="web.api.FormatMap">
      <property name="formats">
         <props>
            <prop key="html">text/html</prop>
            <prop key="xml">text/xml</prop>
            <prop key="atom">application/atom+xml</prop>
            <prop key="rss">application/rss+xml</prop>
            <prop key="opensearchdescription">application/opensearchdescription+xml</prop>
         </props>
      </property>
   </bean>

   <!--  IE Specific set of API Formats -->
   <bean id="web.api.Formats.IE" parent="web.api.FormatMap">
      <property name="agent"><value>MSIE</value></property>
      <property name="formats">
         <props>
            <prop key="atom">text/xml</prop>
            <prop key="rss">text/xml</prop>
         </props>
      </property>
   </bean>


   <!--  -->
   <!--  Web API Service Logger -->
   <!--  -->
   
   <bean id="web.api.ServiceLogger" class="org.alfresco.web.api.ServiceLogger">
   </bean>


   <!--  -->   
   <!--  Web API Authentication -->
   <!--  -->   

   <!--  Alfresco Web Client Authenticator -->
   <bean id="web.api.AlfWebClientAuthenticator" class="org.alfresco.web.api.AlfWebClientAuthenticator">
      <property name="authenticationService" ref="AuthenticationService" />
   </bean>
   
   <!--  HTTP Basic Authenticator -->
   <bean id="web.api.BasicAuthenticator" class="org.alfresco.web.api.BasicAuthenticator">
      <property name="authenticationService" ref="AuthenticationService" />
   </bean>

   <!--  System Authenticator -->
   <bean id="web.api.SystemAuthenticator" class="org.alfresco.web.api.SystemAuthenticator" />


   <!--  -->
   <!--  Web API Service Registry -->   
   <!--  -->

   <bean id="web.api.stores" class="org.alfresco.web.api.APIStores">
      <property name="templateProcessor" ref="web.api.TemplateProcessor" />
   </bean>

   <bean id="web.api.store.classpath" class="org.alfresco.web.api.ClassPathAPIStore">
      <property name="classPath"><value>alfresco/templates/api</value></property>
   </bean>

   <bean id="web.api.Registry" class="org.alfresco.web.api.DeclarativeAPIRegistry">
      <property name="stores" ref="web.api.stores" />
      <property name="authenticator" ref="web.api.AlfWebClientAuthenticator" />
      <property name="serviceLogger" ref="web.api.ServiceLogger" />
      <property name="formatRegistry" ref="web.api.FormatRegistry" />
      <property name="defaultServiceImpl"><value>web.api.ScriptedAPIService</value></property>
   </bean>

   <bean id="web.api.test.Registry" parent="web.api.Registry">
      <property name="authenticator" ref="web.api.SystemAuthenticator" />
   </bean>

   <!--  -->
   <!--  Web API Template Processor -->
   <!--  -->

   <bean id="web.api.TemplateProcessor" class="org.alfresco.web.api.APITemplateProcessor">
      <!-- <property name="defaultEncoding"><value>UTF-8</value></property> -->
   </bean>


   <!--  -->
   <!--  Web API Abstract Service Implementations -->
   <!--  -->

   <!--  Abstract API Service -->
   <bean id="web.api.APIService" abstract="true">
      <property name="serviceRegistry" ref="ServiceRegistry" />
      <property name="descriptorService" ref="DescriptorService" />
   </bean>

   <!--  Scripted API Service -->
   <bean id="web.api.ScriptedAPIService" parent="web.api.APIService" class="org.alfresco.web.api.ScriptedAPIService" singleton="false"/>


   <!--  -->
   <!--  Web API Services -->
   <!--  -->

   <!--  List of available Web APIs -->
   <bean id="web.api.services.org.alfresco.service.index_get" class="org.alfresco.web.api.services.Index" parent="web.api.APIService" />

   <!--  List of registered (OpenSearch) search engines -->
   <bean id="web.api.services.org.alfresco.repository.searchengines_get" class="org.alfresco.web.api.services.SearchEngines" parent="web.api.APIService">
      <property name="configService" ref="web.api.Config" />
      <property name="searchProxy" ref="web.api.services.org.alfresco.repository.searchproxy_get" />
   </bean>

   <!--  Alfresco Web Client Keyword Search (OpenSearch) -->
   <bean id="web.api.services.org.alfresco.repository.keywordsearch_get" class="org.alfresco.web.api.services.KeywordSearch" parent="web.api.APIService">
      <property name="searchService" ref="SearchService" />
   </bean>

   <!--  Alfresco (OpenSearch) Proxy -->
   <bean id="web.api.services.org.alfresco.repository.searchproxy_get" class="org.alfresco.web.api.services.SearchProxy" parent="web.api.APIService">
      <property name="configService" ref="web.api.Config" />
      <property name="formatRegistry" ref="web.api.FormatRegistry" />
   </bean>

</beans>
