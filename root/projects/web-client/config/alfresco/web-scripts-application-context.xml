<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE beans PUBLIC '-//SPRING//DTD BEAN//EN' 'http://www.springframework.org/dtd/spring-beans.dtd'>

<beans>

   <!--  -->
   <!--  API Definition & Implementation Storage -->
   <!--  -->

   <bean id="webscripts.context" class="org.alfresco.web.scripts.WebScriptContext">
      <property name="transactionService" ref="transactionComponent" />
      <property name="namespaceService" ref="namespaceService" />
      <property name="nodeService" ref="nodeService" />
      <property name="personService" ref="personService" />
      <property name="searchService" ref="searchService" />
      <property name="companyHomeStore"><value>${spaces.store}</value></property>
      <property name="companyHomePath"><value>/${spaces.company_home.childname}</value></property>
   </bean>

   <bean id="webscripts.storage" class="org.alfresco.web.scripts.WebScriptStorage">
      <property name="templateProcessor" ref="webscripts.templateprocessor" />
      <property name="scriptProcessor" ref="webscripts.scriptprocessor" />
   </bean>

   <bean id="webscripts.templateprocessor" class="org.alfresco.web.scripts.TemplateProcessor">
      <property name="freeMarkerProcessor" ref="freeMarkerProcessor" />	
      <property name="serviceRegistry" ref="ServiceRegistry" />		
      <!-- <property name="defaultEncoding"><value>UTF-8</value></property> -->
   </bean>

   <bean id="webscripts.scriptprocessor" class="org.alfresco.web.scripts.ScriptProcessor">
      <property name="scriptService" ref="ScriptService" />
   </bean>

   <bean id="webscripts.repostore" class="org.alfresco.web.scripts.RepoStore" abstract="true">
      <property name="transactionService" ref="transactionComponent" />
      <property name="nodeService" ref="nodeService" />
      <property name="namespaceService" ref="namespaceService" />
      <property name="contentService" ref="contentService" />
      <property name="searchService" ref="SearchService" />
   </bean>
   
   <bean id="webscripts.classpathstore" class="org.alfresco.web.scripts.ClassPathStore" abstract="true" />


   <!--                          -->
   <!--  Web Script Search Paths -->
   <!--                          -->

   <bean parent="webscripts.repostore">
      <property name="store"><value>workspace://SpacesStore</value></property>
      <property name="path"><value>/${spaces.company_home.childname}/${spaces.dictionary.childname}/cm:webscripts</value></property>
   </bean>

   <bean parent="webscripts.classpathstore">
      <property name="classPath"><value>alfresco/templates/webscripts</value></property>
   </bean>


   <!--  -->
   <!--  API Service Registry -->   
   <!--  -->

   <bean id="webscripts.registry" class="org.alfresco.web.scripts.DeclarativeWebScriptRegistry">
      <property name="storage" ref="webscripts.storage" />
      <property name="authenticator" ref="webscripts.authenticator.webclient" />
      <property name="serviceLogger" ref="webscripts.logger" />
      <property name="serviceTransaction" ref="webscripts.transaction" />
      <property name="formatRegistry" ref="webscripts.formatregistry" />
      <property name="defaultWebScript"><value>webscript_default</value></property>
   </bean>

   <!--  Service Logger -->
   <bean id="webscripts.logger" class="org.alfresco.web.scripts.WebScriptLogger" />

   <!--  Service Transaction -->
   <bean id="webscripts.transaction" class="org.alfresco.web.scripts.WebScriptTransaction">
      <property name="transactionService" ref="transactionComponent" />
   </bean>

   <!--  Alfresco Web Client Authenticator -->
   <bean id="webscripts.authenticator.webclient" class="org.alfresco.web.scripts.WebClientAuthenticator">
      <property name="authenticationService" ref="AuthenticationService" />
   </bean>
   
   <!--  HTTP Basic Authenticator -->
   <bean id="webscripts.authenticator.basic" class="org.alfresco.web.scripts.BasicAuthenticator">
      <property name="authenticationService" ref="AuthenticationService" />
   </bean>

   <!--  System Authenticator -->
   <bean id="webscripts.authenticator.system" class="org.alfresco.web.scripts.SystemAuthenticator" />

   <!--  Trusted Authenticator -->
   <bean id="webscripts.authenticator.trusted" class="org.alfresco.web.scripts.TrustedAuthenticator" />


   <!--  -->
   <!--  API Response Formats -->
   <!--  -->

   <!--  Format Registry -->
   <bean id="webscripts.formatregistry" class="org.alfresco.web.scripts.FormatRegistry" />

   <!--  Format Map -->
   <bean id="webscripts.formatmap" class="org.alfresco.web.scripts.FormatMap" abstract="true">
      <property name="registry" ref="webscripts.formatregistry" />
   </bean>

   <!--  Default set of API Formats -->
   <bean id="webscripts.formats" parent="webscripts.formatmap">
      <property name="formats">
         <props>
            <prop key="html">text/html</prop>
            <prop key="text">text/plain</prop>
            <prop key="xml">text/xml</prop>
            <prop key="atom">application/atom+xml</prop>
            <prop key="rss">application/rss+xml</prop>
            <prop key="json">application/json</prop>
            <prop key="opensearchdescription">application/opensearchdescription+xml</prop>
            <prop key="wiki">text/plain</prop>
         </props>
      </property>
   </bean>

   <!--  IE Specific set of API Formats -->
   <bean id="webscripts.formats.IE" parent="webscripts.formatmap">
      <property name="agent"><value>MSIE</value></property>
      <property name="formats">
         <props>
            <prop key="atom">text/xml</prop>
            <prop key="rss">text/xml</prop>
         </props>
      </property>
   </bean>


   <!--  -->   
   <!--  API Configuration -->
   <!--  -->   

   <bean id="webscripts.configsource" class="org.alfresco.config.source.UrlConfigSource">
      <constructor-arg>
         <list>
            <value>classpath:alfresco/web-scripts-config.xml</value>
            <value>classpath:alfresco/extension/web-api-config-custom.xml</value>  <!--  for backwards compatibility -->
            <value>classpath:alfresco/extension/web-scripts-config-custom.xml</value>
         </list>
      </constructor-arg>
   </bean>

   <bean id="webscripts.config" class="org.alfresco.config.xml.XMLConfigService" init-method="init">
      <constructor-arg>
         <ref bean="webscripts.configsource" />
      </constructor-arg>
   </bean>


   <!--  -->
   <!--  Base implementations of a Web API Backing Bean -->
   <!--  -->

   <!--  Abstract API Service -->
   <bean id="webscript" abstract="true">
      <property name="scriptContext" ref="webscripts.context" />
      <property name="serviceRegistry" ref="ServiceRegistry" />
      <property name="descriptorService" ref="DescriptorService" />
   </bean>

   <!--  Scripted API Service -->
   <bean id="webscript_default" parent="webscript" class="org.alfresco.web.scripts.DeclarativeWebScript" singleton="false" />


   <!--  -->
   <!--  Custom Java Web API Backing Beans -->
   <!--  -->

   <!--  List of available Web APIs -->
   <bean id="webscript.org.alfresco.index_get" class="org.alfresco.web.scripts.bean.Index" parent="webscript" />

   <!--  Maintain list of available Web APIs -->
   <bean id="webscript.org.alfresco.index_post" class="org.alfresco.web.scripts.bean.IndexUpdate" parent="webscript" />

   <!--  Retrieve Web Script Description Document -->
   <bean id="webscript.org.alfresco.scriptdescription_get" class="org.alfresco.web.scripts.bean.ServiceDescription" parent="webscript" />

   <!--  List of registered (OpenSearch) search engines -->
   <bean id="webscript.org.alfresco.repository.searchengines_get" class="org.alfresco.web.scripts.bean.SearchEngines" parent="webscript">
      <property name="configService" ref="webscripts.config" />
      <property name="searchProxy" ref="webscript.org.alfresco.repository.searchproxy_get" />
   </bean>

   <!--  Alfresco Web Client Keyword Search (OpenSearch) -->
   <bean id="webscript.org.alfresco.repository.keywordsearch_get" class="org.alfresco.web.scripts.bean.KeywordSearch" parent="webscript">
      <property name="searchService" ref="SearchService" />
   </bean>

   <!--  Alfresco (OpenSearch) Proxy -->
   <bean id="webscript.org.alfresco.repository.searchproxy_get" class="org.alfresco.web.scripts.bean.SearchProxy" parent="webscript">
      <property name="configService" ref="webscripts.config" />
      <property name="formatRegistry" ref="webscripts.formatregistry" />
   </bean>

</beans>
