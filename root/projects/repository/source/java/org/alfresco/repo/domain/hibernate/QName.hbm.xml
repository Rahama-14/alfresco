<?xml version='1.0' encoding='UTF-8'?>

<!DOCTYPE hibernate-mapping PUBLIC
    '-//Hibernate/Hibernate Mapping DTD 3.0//EN' 
    'http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd'>

<hibernate-mapping>

   <class
         name="org.alfresco.repo.domain.hibernate.NamespaceEntityImpl"
         proxy="org.alfresco.repo.domain.NamespaceEntity"
         table="alf_namespace"
         dynamic-update="false"
         dynamic-insert="false"
         select-before-update="false" 
         lazy="true" 
         optimistic-lock="version"  >
      <!-- auto-generated ID -->
      <id name="id" column="id" type="long" >
         <generator class="native" />
      </id>
      <!-- Namespace URL must be unique -->
      <natural-id mutable="true">
         <property name="uri" column="uri" type="string" length="100" not-null="true" />
      </natural-id>
      <!-- Optimistic locking -->
      <version column="version" name="version" type="long" />
   </class>

   <class
         name="org.alfresco.repo.domain.hibernate.QNameEntityImpl"
         proxy="org.alfresco.repo.domain.QNameEntity"
         table="alf_qname"
         dynamic-update="false"
         dynamic-insert="false"
         select-before-update="false" 
         lazy="true" 
         optimistic-lock="version"  >
      <!-- auto-generated ID -->
      <id name="id" column="id" type="long" >
         <generator class="native" />
      </id>
      <!-- Namespace and localname must be unique -->
      <natural-id mutable="true">
         <!-- forward assoc to namespace -->
         <many-to-one
               name="namespace"
               class="org.alfresco.repo.domain.hibernate.NamespaceEntityImpl"
               column="ns_id"
               foreign-key="fk_alf_qname_ns"
               lazy="proxy"
               fetch="join"
               unique="false"
               not-null="true"
               cascade="none" />
         <property name="localName" column="local_name" type="string" length="200" not-null="true" />
      </natural-id>
      <!-- Optimistic locking -->
      <version column="version" name="version" type="long" />
   </class>

   <query name="qname.GetNamespaceByUri" flush-mode="never" cacheable="false">
      select
         namespace
      from
         org.alfresco.repo.domain.hibernate.NamespaceEntityImpl as namespace
      where
         namespace.uri = :namespaceUri
   </query>

   <query name="qname.GetQNameByUriAndLocalName" flush-mode="never" cacheable="false">
      select
         qname
      from
         org.alfresco.repo.domain.hibernate.QNameEntityImpl as qname
         join qname.namespace as namespace
      where
         namespace.uri = :namespaceUri and
         qname.localName = :localName
   </query>

</hibernate-mapping>
