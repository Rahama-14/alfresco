<?xml version='1.0' encoding='UTF-8'?>

<!DOCTYPE hibernate-mapping PUBLIC
    '-//Hibernate/Hibernate Mapping DTD 3.0//EN' 
    'http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd'>

<hibernate-mapping>

   <class
         name="org.alfresco.repo.domain.hibernate.VersionCountImpl"
         proxy="org.alfresco.repo.domain.VersionCount"
         table="alf_version_count"
         dynamic-update="false"
         dynamic-insert="false"
         select-before-update="false"
         optimistic-lock="version" >

      <!-- auto-generated ID -->
      <id name="id" column="id" type="long" >
         <generator class="native" />
      </id>
      <!-- Optimistic locking -->
      <version column="version" name="version" type="long" />

      <!-- forward assoc to store -->
      <many-to-one
            name="store"
            class="org.alfresco.repo.domain.hibernate.StoreImpl"
            column="store_id"
            not-null="true"
            foreign-key="fk_alf_vc_store"
            unique="true"
            lazy="proxy"
            optimistic-lock="false"
            fetch="select" />

      <property name="versionCount" column="version_count" type="int" not-null="true" />

   </class>
   
   <query name="versionCount.GetVersionCountForStore">
      select
         cnt
      from 
         org.alfresco.repo.domain.hibernate.VersionCountImpl as cnt
      where
         cnt.store.protocol = :protocol and
         cnt.store.identifier = :identifier
   </query>

</hibernate-mapping>
