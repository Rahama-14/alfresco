<project name="repository" default="build">

   <path id="path.common" path="${basedir}/../../common"/>
   <property name="dir.common" refid="path.common"/>
   <import file="${dir.common}/common.xml"/>

   <target name="compile-java" depends="common.compile-java">
      <antcall target="compile-jibx" />
   </target>

   <target name="compile-jibx" depends="init">
      <bind verbose="false" load="true" binding="${file.jibx.binding}">
         <classpathset dir="${dir.classes}"/>
      </bind>
   </target>

   <target name="compile-javadocs" depends="common.compile-javadocs" description="Creates the JavaDocs for the project">
      <mkdir dir="${dir.javadoc.api.service}" />
      <javadoc sourcepath="${dir.src.java}" destdir="${dir.javadoc.api.service}" 
               packagenames="org.alfresco.service.*" excludepackagenames=""
               author="true" version="true" doctitle="Alfresco Content Management Service API Specification" 
               windowtitle="Alfresco Content Management Service API" classpathref="classpath.compile">
         <bottom>${javadoc.copyright}</bottom>
      </javadoc>  
   </target>
   
   <target name="build-single-jar" depends="common.compile-java" description="Build an self-contained executable jar" >
      <property name="dir.one-jar" value="${dir.build}/one-jar" />
      <!-- extract the one-jar file -->
      <unjar src="${dir.common.lib}/one-jar/one-jar-boot-0.95.jar" dest="${dir.one-jar}" overwrite="true" />
      <!-- remove unwanted files -->
      <delete >
         <fileset dir="${dir.one-jar}">
            <include name="**/*.java" />
            <include name="**/boot-manifest.mf" />
         </fileset>
      </delete>
      <!-- copy required jars into lib folder -->
      <copy todir="${dir.one-jar}/lib" flatten="false">
         <fileset dir="${dir.common.lib}" includes="**/*.jar" />
         <fileset dir="${dir.project.core}/build/dist" includes="${dir.name.core}.jar" />
         <fileset dir="${dir.project.core}/source/java" includes="**/*log4j.properties" />
         <fileset dir="${dir.project.repository}/build/dist" includes="${dir.name.repository}.jar" />
      </copy>
      <!-- delete target one-jar -->
      <delete file="${dir.dist}/alfresco-repository.jar" />
      <!-- build the one-jar -->
      <jar destfile="${dir.dist}/alfresco-repository.jar" manifest="${dir.one-jar}/META-INF/MANIFEST.MF" update="false" >
         <fileset dir="${dir.one-jar}">
            <include name="**/*" />
         </fileset>
      </jar>
   </target>
  
</project>
