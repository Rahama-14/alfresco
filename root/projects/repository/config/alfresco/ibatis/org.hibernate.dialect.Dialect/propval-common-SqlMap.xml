<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="alfresco.propval">

    <!--                -->
    <!-- Type Defs      -->
    <!--                -->
    
    <typeAlias alias="PropertyClass" type="org.alfresco.repo.domain.propval.PropertyClassEntity"/>
    <typeAlias alias="PropertyStringValue" type="org.alfresco.repo.domain.propval.PropertyStringValueEntity"/>
    <typeAlias alias="PropertyDoubleValue" type="org.alfresco.repo.domain.propval.PropertyDoubleValueEntity"/>
    <typeAlias alias="PropertyValue" type="org.alfresco.repo.domain.propval.PropertyValueEntity"/>

    <!--                -->
    <!-- Result Maps    -->
    <!--                -->

    <resultMap id="result.PropertyClass" class="PropertyClass">
        <result property="id" column="id" jdbcType="BIGINT" javaType="java.lang.Long"/>
        <result property="javaClassName" column="java_class_name" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <result property="javaClassNameShort" column="java_class_name_short" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <result property="javaClassNameCrc" column="java_class_name_crc" jdbcType="BIGINT" javaType="java.lang.Long"/>
    </resultMap>
    <resultMap id="result.PropertyStringValue" class="PropertyStringValue">
        <result property="id" column="id" jdbcType="BIGINT" javaType="java.lang.Long"/>
        <result property="stringValue" column="string_value" jdbcType="VARCHAR" javaType="java.lang.String"/>
    </resultMap>
    <resultMap id="result.PropertyDoubleValue" class="PropertyDoubleValue">
        <result property="id" column="id" jdbcType="BIGINT" javaType="java.lang.Long"/>
        <result property="doubleValue" column="double_value" jdbcType="DOUBLE" javaType="java.lang.Double"/>
    </resultMap>
    <resultMap id="result.PropertyValue" class="PropertyValue">
        <result property="id" column="id" jdbcType="BIGINT" javaType="java.lang.Long"/>
        <result property="longValue" column="long_value" jdbcType="BIGINT" javaType="java.lang.Long"/>
    </resultMap>
  
    <!--                -->
    <!-- Parameter Maps -->
    <!--                -->

<!-- 
    <parameterMap id="parameter.ExclusiveLockUpdateMap" class="map">
        <parameter property="newLockToken" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <parameter property="newStartTime" jdbcType="BIGINT" javaType="java.lang.Long"/>
        <parameter property="newExpiryTime" jdbcType="BIGINT" javaType="java.lang.Long"/>
        <parameter property="exclusiveLockResourceId" jdbcType="BIGINT" javaType="java.lang.Long"/>
        <parameter property="oldLockToken" jdbcType="VARCHAR" javaType="java.lang.String"/>
    </parameterMap>
 -->
  
    <!--                -->
    <!-- SQL Snippets   -->
    <!--                -->
    
    <sql id="insert.PropertyClass.AutoIncrement">
        insert into alf_prop_class (java_class_name, java_class_name_short, java_class_name_crc) 
        values (#javaClassName#, #javaClassNameShort#, #javaClassNameCrc#)
    </sql>
    
    <sql id="insert.PropertyStringValue.AutoIncrement">
        insert into alf_prop_string_value (string_value) 
        values (#stringValue#)
    </sql>
    
    <sql id="insert.PropertyDoubleValue.AutoIncrement">
        insert into alf_prop_double_value (double_value) 
        values (#doubleValue#)
    </sql>
    
    <sql id="insert.PropertyValue.AutoIncrement">
        insert into alf_prop_value (persisted_type, long_value) 
        values (#persistedType#, #longValue#)
    </sql>
    
    <!--                -->
    <!-- Statements     -->
    <!--                -->
    
    <!-- Get a property class by ID -->
    <select id="select.PropertyClassByID" parameterClass="PropertyClass" resultMap="result.PropertyClass">
        select
            *
        from
            alf_prop_class
        where
            id = #id#
    </select>

    <!-- Get the property class by class name -->
    <select id="select.PropertyClassByName" parameterClass="PropertyClass" resultMap="result.PropertyClass">
        select
            *
        from
            alf_prop_class
        where
            java_class_name_crc = #javaClassNameCrc# and
            java_class_name_short = #javaClassNameShort#
    </select>

    <!-- Get a property string value by ID -->
    <select id="select.PropertyStringValueByID" parameterClass="PropertyStringValue" resultMap="result.PropertyStringValue">
        select
            *
        from
            alf_prop_string_value
        where
            id = #id#
    </select>

    <!-- Get the property string value by string -->
    <select id="select.PropertyStringValueByString" parameterClass="PropertyStringValue" resultMap="result.PropertyStringValue">
        select
            *
        from
            alf_prop_string_value
        where
            string_value = #stringValue#
    </select>

    <!-- Get a property simple value by ID -->
    <select id="select.PropertyDoubleValueByID" parameterClass="PropertyDoubleValue" resultMap="result.PropertyDoubleValue">
        select
            *
        from
            alf_prop_double_value
        where
            id = #id#
    </select>

    <!-- Get the property string value by string -->
    <select id="select.PropertyDoubleValueByValue" parameterClass="PropertyDoubleValue" resultMap="result.PropertyDoubleValue">
        select
            *
        from
            alf_prop_double_value
        where
            double_value = #doubleValue#
    </select>

</sqlMap>