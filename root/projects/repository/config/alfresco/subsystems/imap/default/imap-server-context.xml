<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE beans PUBLIC '-//SPRING//DTD BEAN//EN' 'http://www.springframework.org/dtd/spring-beans.dtd'>

<beans>

    <bean id="imapResourceBundles" class="org.alfresco.i18n.ResourceBundleBootstrapComponent">
        <property name="resourceBundles">
            <list>
                <value>alfresco.messages.imap-service</value>
            </list>
        </property>
    </bean>

    <bean id="imapServer" class="org.alfresco.repo.imap.AlfrescoImapServer">
        <property name="port">
            <value>${imap.server.port}</value>
        </property>
        <property name="imapServerEnabled">
            <value>${imap.server.enabled}</value>
        </property>
        <property name="imapHostManager">
            <ref local="imapHostManager" />
        </property>
        <property name="imapUserManager">
            <ref local="imapUserManager" />
        </property>
    </bean>

    <!--The configurable list of mount points - actually a post-processed composite property! -->
    <bean id="imap.server.mountPoints" class="org.springframework.beans.factory.config.ListFactoryBean">
        <property name="sourceList">
            <list>
                <bean id="Repository_virtual" class="org.alfresco.repo.imap.config.ImapConfigBean">
                    <property name="mode">
                        <value>virtual</value>
                    </property>
                    <property name="store">
                        <value>${spaces.store}</value>
                    </property>
                    <property name="rootPath">
                        <value>/${spaces.company_home.childname}</value>
                    </property>
                </bean>
                <bean id="Repository_archive" class="org.alfresco.repo.imap.config.ImapConfigBean">
                    <property name="mode">
                        <value>archive</value>
                    </property>
                    <property name="store">
                        <value>${spaces.store}</value>
                    </property>
                    <property name="rootPath">
                        <value>/${spaces.company_home.childname}</value>
                    </property>
                </bean>
            </list>
        </property>
    </bean>

    <bean id="imapHelper" class="org.alfresco.repo.imap.ImapHelper">
        <property name="nodeService" ref="NodeService" />
        <property name="fileFolderService" ref="FileFolderService" />
        <property name="searchService" ref="SearchService" />
        <property name="namespaceService" ref="NamespaceService" />
        <property name="templateService" ref="TemplateService" />
        <property name="permissionService" ref="PermissionService" />
        <property name="dictionaryService" ref="DictionaryService" />
        <property name="preferenceService" ref="PreferenceService" />
        <property name="siteService" ref="SiteService" />
        <property name="patchService" ref="patchComponent" />
        <property name="serviceRegistry" ref="ServiceRegistry" />

        <property name="imapConfigBeans">
            <ref bean="imap.server.mountPoints" />
        </property>

        <property name="defaultFromAddress">
            <value>${mail.from.default}</value>
        </property>

        <property name="webApplicationContextUrl">
            <value>${web.application.context.url}</value>
        </property>

        <property name="imapRoot">
            <value>${spaces.store}/${spaces.company_home.childname}/${spaces.imap_home.childname}</value>
        </property>

        <property name="repositoryTemplatePath">
            <value>${spaces.store}/${spaces.company_home.childname}/${spaces.dictionary.childname}/${spaces.imapConfig.childname}/${spaces.imap_templates.childname}</value>
        </property>
    </bean>

    <bean id="imapHostManager" class="org.alfresco.repo.imap.AlfrescoImapHostManager">
        <property name="serviceRegistry" ref="ServiceRegistry" />
        <property name="nodeService" ref="NodeService" />
        <property name="fileFolderService" ref="FileFolderService" />
        <property name="imapHelper" ref="imapHelper" />
    </bean>

    <bean id="imapUserManager" class="org.alfresco.repo.imap.AlfrescoImapUserManager">
        <property name="imapHostManager">
            <ref local="imapHostManager" />
        </property>
        <property name="authenticationService" ref="AuthenticationService" />
        <property name="personService" ref="PersonService" />
        <property name="nodeService" ref="NodeService" />
    </bean>
</beans>
