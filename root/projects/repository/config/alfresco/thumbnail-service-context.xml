<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE beans PUBLIC '-//SPRING//DTD BEAN//EN' 'http://www.springframework.org/dtd/spring-beans.dtd'>

<beans>

    <!-- Thumbnail service bean -->
    <bean id="ThumbnailService" class="org.springframework.aop.framework.ProxyFactoryBean">
        <property name="proxyInterfaces">
            <value>org.alfresco.service.cmr.thumbnail.ThumbnailService</value>
        </property>
        <property name="target">
            <ref bean="thumbnailService"/>
        </property>
        <property name="interceptorNames">
            <list>
                <idref local="ThumbnailService_transaction"/>
                <idref bean="AuditMethodInterceptor"/>
                <idref bean="exceptionTranslator"/>
                <idref local="ThumbnailService_security"/>
            </list>
        </property>
    </bean>

    <!-- Thumbnail service transaction bean -->
    <bean id="ThumbnailService_transaction" class="org.springframework.transaction.interceptor.TransactionInterceptor">
        <property name="transactionManager">
            <ref bean="transactionManager"/>
        </property>
        <property name="transactionAttributes">
            <props>
                <prop key="*">${server.transaction.mode.default}</prop>
            </props>
        </property>
    </bean>
    
    <!-- Thumbnail service security bean -->
    <bean id="ThumbnailService_security" class="org.alfresco.repo.security.permissions.impl.AlwaysProceedMethodInterceptor" />
    
    <!-- Thumbnail service implementation bean -->
    <bean id="thumbnailService" class="org.alfresco.repo.thumbnail.ThumbnailServiceImpl">
    	<property name="nodeService" ref="nodeService"/>
    	<property name="contentService" ref="contentService"/>
    	<property name="mimetypeMap" ref="mimetypeService"/>
        <property name="renditionService" ref="renditionService" />
    	<property name="behaviourFilter" ref="policyBehaviourFilter" />
    	<property name="thumbnailRegistry" ref="thumbnailRegistry" />
    </bean>
    
    <!-- This bean is responsible for the conversion of thumbnail definitions to
     rendition definitions and vice versa -->
    <bean id ="thumbnailRenditionConvertor" class="org.alfresco.repo.thumbnail.ThumbnailRenditionConvertor" />
    
    <!-- Thumbnail Register -->
    <bean id="thumbnailRegistry" class="org.alfresco.repo.thumbnail.ThumbnailRegistry">
        <property name="contentService" ref="ContentService"/>
        <property name="renditionService" ref="renditionService" />
    	<property name="thumbnails">
            <list>
              <value>medium</value>
              <value>doclib</value>
              <value>webpreview</value>
              <value>imgpreview</value>
              <value>avatar</value>
            </list>
        </property>
        <property name="thumbnailRenditionConvertor" ref="thumbnailRenditionConvertor" />
    </bean>    
    
    <!-- Create Thumbnail Action -->
    <bean id="create-thumbnail" class="org.alfresco.repo.thumbnail.CreateThumbnailActionExecuter" parent="action-executer">
      <property name="publicAction">
         <value>false</value>
      </property>
        <property name="nodeService">
            <ref bean="NodeService" />
        </property>
        <property name="thumbnailService">
            <ref bean="ThumbnailService" />
        </property>
    </bean> 
    
    <!-- Update Thumbnail Action -->
    <bean id="update-thumbnail" class="org.alfresco.repo.thumbnail.UpdateThumbnailActionExecuter" parent="action-executer">
        <property name="publicAction">
           <value>false</value>
        </property>
        <property name="nodeService">
            <ref bean="NodeService" />
        </property>
        <property name="renditionService">
            <ref bean="RenditionService" />
        </property>
        <property name="thumbnailService">
            <ref bean="ThumbnailService" />
        </property>
    </bean> 
    
    <!-- Thumbnail service script API -->    
    <bean id="thumbnailServiceScript" parent="baseJavaScriptExtension" class="org.alfresco.repo.thumbnail.script.ScriptThumbnailService">
        <property name="extensionName">
            <value>thumbnailService</value>
        </property>
        <!-- Creates ScriptNodes which require the ServiceRegistry -->
        <property name="serviceRegistry" ref="ServiceRegistry"/>
    </bean>
    
    <!-- This action filter bean prevents multiple equivalent create-thumbnail actions from executing
         simultaneously in the Asynchronous Action Execution Service -->
    <bean id="createThumbnailActionFilter" class="org.alfresco.repo.action.CreateThumbnailActionFilter" parent="baseActionFilter">
       <property name="name">
           <value>preventMultipleCreateThumbnailActions</value>
       </property>
       <!-- The action-definition-name against which this bean will be registered. -->
       <property name="actionDefinitionName">
           <value>create-thumbnail</value>
       </property>
   </bean>
    

</beans>
