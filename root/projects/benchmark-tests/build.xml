<project name="BenchmarkTests" default="run"  basedir=".">

   <path id="path.common" path="${basedir}/../../common"/>
   <property name="dir.common" refid="path.common"/>
   <import file="${dir.common}/common.xml"/>

    <property environment="env"/>
    
    <property name="config" value="config/testConfig.xml"/>

    <path id="class.path">
        <fileset dir="../benchmark-framework/lib/japex" includes="*.jar"/>
    </path>

    <target name="compile-java" depends="init" description="Compiles the Java source code">
      <mkdir dir="${dir.classes}" />
      <javac destdir="${dir.classes}" fork="true" deprecation="on" debug="on" target="1.5" source="1.5">
          <src path="${dir.src.java}" />
          <classpath refid="classpath.compile" />
          <classpath refid="class.path"/>
      </javac>

      <copy todir="${dir.classes}">
          <fileset dir="${dir.src.java}">
              <patternset>
                  <exclude name="**/*.java" />
              </patternset>
          </fileset>
      </copy>
    </target>

    <target name="run">
        <java dir="." fork="true" classname="com.sun.japex.Japex">
            <jvmarg value="-server"/>
            <jvmarg value="-Xms512m"/>
            <jvmarg value="-Xmx1024m"/>
            <jvmarg value="-Xss64k"/>
            <classpath refid="class.path"/>
            <arg line="${config}"/>
        </java>
    </target>
    
    <target name="debug-nb">
        <property name="src.folders" value="./src:./src/binding:../../src:../../src/binding"/>
        <path id="cp">
            <pathelement location="../../build/classes"/>
            <path refid="class.path"/>
        </path>
        <nbjpdastart addressproperty="jpda.address" name="Japex" transport="dt_socket">
            <classpath refid="cp"/>
        </nbjpdastart>
        <java classname="com.sun.japex.Japex" fork="true">
            <classpath refid="cp"/>
            <jvmarg value="-Xdebug"/>
            <jvmarg value="-Xnoagent"/>
            <jvmarg value="-Djava.compiler=none"/>
            <jvmarg value="-Xrunjdwp:transport=dt_socket,address=${jpda.address}"/>
            <arg line="${config}"/>
        </java>
    </target>
    
</project>
