<?xml version="1.0" encoding="UTF-8"?>

<process-definition xmlns="urn:jbpm.org:jpdl-3.1" name="wf:invite">
    
    <swimlane name="initiator" />
        
    <start-state name="start">
        <task name="wf:startInviteTask" swimlane="initiator" />
        <transition name="" to="inviteToSite"/>
    </start-state>
    
    <task-node name="inviteToSite">
        <task name="wf:inviteToSiteTask" swimlane="initiator" />
        <transition name="" to="invitePending">
            <action class="org.alfresco.repo.workflow.jbpm.AlfrescoJavaScript">
                <script>
                    var mail = actions.create("mail");
                    mail.parameters.to = invitee.properties["cm:email"];
                    <!-- TODO glen.johnson@alfresco.com - need to include Site name on subject line"
                    need to include a variable to store this -->
                    mail.parameters.subject = "Invitation to Alfresco Site";
                    mail.parameters.from = bpm_assignee.properties["cm:email"];
                    mail.parameters.text = "Hello,\n"
                        + "You have been invited to join the some_site_name Site.\n"
                        + "Your role in the site will be Collaborator.\n\n"
                        + "Please click here http://localhost:8080/alfresco/service/api/inviteToSite?response=accept to accept the invitation\n"
                        + "An account has been created for you with user" + invitee.properties["cm:name"] + "\n"
                        + "An initial password has been generated for you" + some_generated_password"
                        + ", please change it to a password of your choice once you have logged into the Site\n\n"   
                        + "Please click here http://localhost:8080/alfresco/service/api/inviteToSite?response=reject to reject the invitation\n";
                    mail.execute();
                </script>
            </action>
        </transition>
    </task-node>
    
    <fork name="invitePending">
        <transition name="accept" to="inviteAccepted"/>
        <transition name="reject" to="inviteRejected"/>
        <transition name="cancel" to="acceptedOrRejectedOrCancelled"/>
    </fork>
    
    <task-node name="inviteAccepted">
        <task name="wf:acceptInviteTask" swimlane="initiator" />
        <transition name="" to="acceptedOrRejectedOrCancelled"/>
    </task-node>
    
    <task-node name="inviteRejected">
        <task name="wf:rejectInviteTask" swimlane="initiator" />
        <transition name="" to="acceptedOrRejectedOrCancelled"/>
    </task-node>
    
    <join name="acceptedOrRejectedOrCancelled">
        <transition name="" to="end"/>
    </join>
    
    <end-state name="end"/>
    
</process-definition>
